# ğŸ›¡ï¸ Check Dependency - MCP å®‰å…¨å®¡è®¡å·¥å…·

ä¸€ä¸ªåŸºäº Model Context Protocol (MCP) çš„ Node.js ä¾èµ–å®‰å…¨å®¡è®¡å·¥å…·ï¼Œä¸“ä¸ºç°ä»£ AI å¼€å‘ç¯å¢ƒè®¾è®¡ã€‚

## ğŸš€ é¡¹ç›®ç®€ä»‹

Check Dependency æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä¾èµ–å®‰å…¨å®¡è®¡å·¥å…·ï¼Œé€šè¿‡ MCP åè®®ä¸º AI åŠ©æ‰‹æä¾›å®æ—¶çš„ä¾èµ–å®‰å…¨æ£€æŸ¥åŠŸèƒ½ã€‚è¯¥å·¥å…·è°ƒç”¨ npm å®˜æ–¹å®‰å…¨å®¡è®¡ APIï¼Œèƒ½å¤Ÿå¿«é€Ÿè¯†åˆ«é¡¹ç›®ä¸­çš„å®‰å…¨æ¼æ´ï¼Œå¹¶æä¾›è¯¦ç»†çš„ä¿®å¤å»ºè®®ã€‚

### âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ” **å®æ—¶å®‰å…¨å®¡è®¡**: è°ƒç”¨ npm å®˜æ–¹ API è¿›è¡Œä¾èµ–å®‰å…¨æ£€æŸ¥
- ğŸ“Š **è¯¦ç»†æ¼æ´æŠ¥å‘Š**: æä¾›æ¼æ´ç­‰çº§ã€æè¿°ã€ä¿®å¤å»ºè®®ç­‰å®Œæ•´ä¿¡æ¯
- ğŸ¤– **AI é›†æˆå‹å¥½**: åŸºäº MCP åè®®ï¼Œå®Œç¾é›†æˆåˆ° Cursor ç­‰ AI å¼€å‘å·¥å…·
- âš¡ **æ‰¹é‡å¤„ç†**: æ”¯æŒåŒæ—¶å®¡è®¡å¤šä¸ªä¾èµ–é¡¹
- ğŸ› ï¸ **å¼€ç®±å³ç”¨**: ç®€å•é…ç½®å³å¯å¼€å§‹ä½¿ç”¨
- ğŸ”„ **æ™ºèƒ½é‡è¯•**: å†…ç½®é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿å®¡è®¡ç»“æœçš„å¯é æ€§

## ğŸ“¦ å®‰è£…

### å‰ç½®è¦æ±‚

- Node.js >= 18.0.0
- npm >= 8.0.0

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone <repository-url>
cd check-dependency

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ç›´æ¥è¿è¡Œ
node build/index.js

# æˆ–ä½¿ç”¨ npm è„šæœ¬
npm run build && node build/index.js
```

### 2. ä½œä¸º MCP å·¥å…·ä½¿ç”¨

è¯¥å·¥å…·ä¸»è¦è®¾è®¡ä¸º MCP å·¥å…·ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨ï¼š

```typescript
// è°ƒç”¨å®¡è®¡å·¥å…·
const result = await mcpClient.call('audit_it', {
  dependencies: {
    react: '^18.2.0',
    axios: '^1.6.7',
    lodash: '4.17.21',
  },
})
```

## ğŸ¯ åœ¨ AI å¼€å‘å·¥å…·ä¸­ä½¿ç”¨

### Cursor é›†æˆ

Cursor æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ AI ä»£ç ç¼–è¾‘å™¨ï¼Œæ”¯æŒ MCP åè®®ã€‚ä»¥ä¸‹æ˜¯é›†æˆæ­¥éª¤ï¼š

#### 1. é…ç½® MCP æœåŠ¡å™¨

åœ¨ Cursor çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š

```json
{
  "mcpServers": {
    "check-dependency": {
      "command": "node",
      "args": ["<path-to-project>/build/index.js"],
      "name": "ä¾èµ–å®‰å…¨å®¡è®¡",
      "description": "æ£€æŸ¥é¡¹ç›®ä¾èµ–çš„å®‰å…¨æ¼æ´"
    }
  }
}
```

#### 2. å¯åŠ¨æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨æœåŠ¡
npm run build
node build/index.js
```

#### 3. åœ¨ Cursor ä¸­ä½¿ç”¨

ç°åœ¨æ‚¨å¯ä»¥åœ¨ Cursor ä¸­é€šè¿‡ AI åŠ©æ‰‹ä½¿ç”¨ä¾èµ–å®¡è®¡åŠŸèƒ½ï¼š

```
è¯·å¸®æˆ‘å®¡è®¡å½“å‰é¡¹ç›®çš„ä¾èµ–å®‰å…¨æ€§
```

AI åŠ©æ‰‹å°†è‡ªåŠ¨è°ƒç”¨ `audit_it` å·¥å…·ï¼Œåˆ†ææ‚¨çš„ `package.json` æ–‡ä»¶å¹¶è¿”å›è¯¦ç»†çš„å®‰å…¨æŠ¥å‘Šã€‚

### å…¶ä»– MCP å…¼å®¹å·¥å…·

è¯¥å·¥å…·ç†è®ºä¸Šå…¼å®¹æ‰€æœ‰æ”¯æŒ MCP åè®®çš„å·¥å…·ï¼ŒåŒ…æ‹¬ï¼š

- Claude Desktop
- å…¶ä»–åŸºäº MCP çš„ AI åŠ©æ‰‹
- è‡ªå®šä¹‰çš„ MCP å®¢æˆ·ç«¯

## ğŸ“‹ API æ–‡æ¡£

### audit_it å·¥å…·

**æè¿°**: å®¡è®¡é¡¹ç›®ä¾èµ–çš„å®‰å…¨æ¼æ´

**å‚æ•°**:

```typescript
{
  dependencies: Record<string, string> // ä¾èµ–å¯¹è±¡ï¼Œé”®ä¸ºåŒ…åï¼Œå€¼ä¸ºç‰ˆæœ¬å·
}
```

**è¿”å›å€¼**:

```typescript
{
  content: Array<{
    type: 'text'
    text: string // JSON æ ¼å¼çš„æ¼æ´ä¿¡æ¯æ•°ç»„
  }>
}
```

### æ¼æ´ä¿¡æ¯ç»“æ„

```typescript
interface Vulnerability {
  name: string // æ¼æ´æ‰€åœ¨çš„åŒ…å
  version: string // å—å½±å“çš„ç‰ˆæœ¬èŒƒå›´
  severity: 'critical' | 'high' | 'moderate' | 'low' // æ¼æ´ç­‰çº§
  description: string // æ¼æ´æè¿°
  recommendation: string // å®˜æ–¹ä¿®å¤å»ºè®®
  fixAvailable: boolean // æ˜¯å¦å­˜åœ¨ä¿®å¤ç‰ˆæœ¬
  fixedVersion?: string // ä¿®å¤äº†è¯¥æ¼æ´çš„ç‰ˆæœ¬
  githubAdvisoryId?: string // GitHub æ¼æ´æ•°æ®åº“ç¼–å·
  updatedAt?: string // æ¼æ´ä¿¡æ¯æœ€åæ›´æ–°æ—¶é—´
  moreInfo?: string // è¯¦ç»†ä¿¡æ¯é“¾æ¥
}
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
src/
â”œâ”€â”€ index.ts       # ä¸»å…¥å£æ–‡ä»¶ï¼Œå¯åŠ¨ MCP æœåŠ¡å™¨
â”œâ”€â”€ server.ts      # MCP æœåŠ¡å™¨é…ç½®
â”œâ”€â”€ tools.ts       # å·¥å…·æ³¨å†Œå’Œè·¯ç”±
â”œâ”€â”€ security.ts    # æ ¸å¿ƒå®‰å…¨å®¡è®¡é€»è¾‘
â””â”€â”€ types.ts       # TypeScript ç±»å‹å®šä¹‰
```

### æ ¸å¿ƒç»„ä»¶

1. **MCP æœåŠ¡å™¨**: åŸºäº `@modelcontextprotocol/sdk` æ„å»º
2. **å®‰å…¨å®¡è®¡å™¨**: `SecurityAuditHandler` ç±»å¤„ç†æ‰€æœ‰å®¡è®¡é€»è¾‘
3. **npm API é›†æˆ**: ä½¿ç”¨ `npm-registry-fetch` è°ƒç”¨å®˜æ–¹ API
4. **ç±»å‹å®‰å…¨**: ä½¿ç”¨ `zod` è¿›è¡Œå‚æ•°éªŒè¯

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- âœ… **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„åŒ…åå’Œç‰ˆæœ¬å·æ ¼å¼æ ¡éªŒ
- âœ… **é”™è¯¯å¤„ç†**: å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œ MCP é”™è¯¯è½¬æ¢
- âœ… **API é™åˆ¶**: å†…ç½®é‡è¯•æœºåˆ¶å’Œè¶…æ—¶ä¿æŠ¤
- âœ… **æ•°æ®æ¸…æ´—**: å¯¹ npm API è¿”å›æ•°æ®è¿›è¡Œå®‰å…¨è¿‡æ»¤

## ğŸš€ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰é…ç½®

æ‚¨å¯ä»¥é€šè¿‡ä¿®æ”¹ `src/security.ts` ä¸­çš„é…ç½®æ¥è‡ªå®šä¹‰å®¡è®¡è¡Œä¸ºï¼š

```typescript
// ä¿®æ”¹ API è°ƒç”¨å‚æ•°
const result = await npmFetch.json('/-/npm/v1/security/audits', {
  method: 'POST',
  body: auditData,
  gzip: true,
  timeout: 30000, // è‡ªå®šä¹‰è¶…æ—¶æ—¶é—´
  retry: {
    retries: 3, // è‡ªå®šä¹‰é‡è¯•æ¬¡æ•°
    factor: 2,
    minTimeout: 1000,
    maxTimeout: 10000,
  },
})
```

### æ‰©å±•åŠŸèƒ½

æ‚¨å¯ä»¥é€šè¿‡æ·»åŠ æ–°çš„å·¥å…·æ¥æ‰©å±•åŠŸèƒ½ï¼š

```typescript
// åœ¨ tools.ts ä¸­æ·»åŠ æ–°å·¥å…·
server.tool(
  'check_specific_package',
  'æ£€æŸ¥ç‰¹å®šåŒ…çš„è¯¦ç»†ä¿¡æ¯',
  { packageName: z.string() },
  async ({ packageName }) => {
    // å®ç°ç‰¹å®šåŒ…æ£€æŸ¥é€»è¾‘
  }
)
```

## ğŸ“Š ç¤ºä¾‹è¾“å‡º

```json
[
  {
    "name": "lodash",
    "version": "<4.17.21",
    "severity": "high",
    "description": "Lodash åŸå‹æ±¡æŸ“æ¼æ´",
    "recommendation": "å‡çº§åˆ° 4.17.21 æˆ–æ›´é«˜ç‰ˆæœ¬",
    "fixAvailable": true,
    "fixedVersion": ">=4.17.21",
    "githubAdvisoryId": "GHSA-35jh-r3h4-6jhm",
    "updatedAt": "2021-02-15T00:00:00.000Z",
    "moreInfo": "https://github.com/advisories/GHSA-35jh-r3h4-6jhm"
  }
]
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯: `git checkout -b feature/your-feature`
3. æäº¤æ›´æ”¹: `git commit -am 'Add some feature'`
4. æ¨é€åˆ°åˆ†æ”¯: `git push origin feature/your-feature`
5. æäº¤ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ ISC è®¸å¯è¯ã€‚

## ğŸ†˜ æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜æˆ–æœ‰ç–‘é—®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [Issues](../../issues) é¡µé¢
2. åˆ›å»ºæ–°çš„ Issue
3. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£

## ğŸ”„ ç‰ˆæœ¬å†å²

- **1.0.0**: åˆå§‹ç‰ˆæœ¬
  - åŸºç¡€ MCP æœåŠ¡å™¨åŠŸèƒ½
  - npm ä¾èµ–å®‰å…¨å®¡è®¡
  - Cursor é›†æˆæ”¯æŒ

---

**æ³¨æ„**: è¯¥å·¥å…·ä¾èµ–äº npm å®˜æ–¹ APIï¼Œè¯·ç¡®ä¿æ‚¨çš„ç½‘ç»œç¯å¢ƒèƒ½å¤Ÿè®¿é—® npm registryã€‚ä¼ä¸šç”¨æˆ·å¯èƒ½éœ€è¦é…ç½®ä»£ç†æˆ–ä½¿ç”¨å†…éƒ¨ npm registryã€‚
